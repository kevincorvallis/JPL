<!DOCTYPE html>
<html>
    <head>
        <!-- Plotly.js -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <!-- D3 -->
        <script src="https://d3js.org/d3.v4.js"></script>
         <!-- J-Qeury -->
         <!-- <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script> -->
         <script src ="libraries/jquery-3.4.1.js"></script>
         <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
         <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
         <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
      </head>
      <header>This is example graphs using plotly.js</header>
  <body>
      <head>First Graph</head>
      <div id="myDiv"><!-- Plotly chart will be drawn inside this DIV --></div>
      <head>Second Graph</head>
      <div id="secondgraph"><!-- Plotly chart will be drawn inside this DIV --></div>
    <script>

        $(document).ready(function() {
        $.ajax({
            type: "GET",
            url: "data/explicitMargindata.csv",
            dataType: "text",
            success: function(data) {processData(data);}
        });
        });
        // var data;
        // function(err, rows){
        //     function unpack(rows, key) {
        //         return rows.map(function(row) { return row[key]; });
        // }
        function processData(allText) {
            //Format the data and put it into pretty form
            var allTextLines = allText.split(/\r\n|\n/);
            var headers = allTextLines[0].split(',');
            var lines = [];

            for (var i=1; i<allTextLines.length; i++) {
                var data = allTextLines[i].split(',');
                if (data.length == headers.length) {

                    var tarr = [];
                    for (var j=0; j<headers.length; j++) {
                    tarr.push(data[j]);
                    }
                    lines.push(tarr);
                }
            }
            // alert(lines);
            // console.log(lines);
            // Formatting the data into graphical use
            var all = [];
            var sb = [];
            var arm = [];
            var drive = [];
            // console.log(unpack(rows, "all"));
            for (var j = 0; j < lines.length; j++){
                // console.log(lines[j][0]);
                all.push(lines[j][0]);
                sb.push(lines[j][1]);
                arm.push(lines[j][2]);
                drive.push(lines[j][3]);

            }
            // console.log(all.sort())
            var trace1 = {
                x: [-125, -100, -75, -50, -25, 0, 25],   
                y: all,
                name: "All",
                type: 'bar'
            };
            var trace2 = {
                x: [-125, -100, -75, -50, -25, 0, 25],
                y: sb,
                type: 'bar',
                name: "SB"
            };
            var trace3 = {
                x: [-125, -100, -75, -50, -25, 0, 25],
                y: arm,
                type: 'bar',
                name: "arm"

            };
            var trace4 = {
                x: [-125, -100, -75, -50, -25, 0, 25],
                y: drive,
                type: 'bar',
                name: "drive"
            };

            var data = [trace1, trace2, trace3, trace4];
            console.log(all.length);
            console.log(sb.length);
            console.log(arm.length);
            console.log(drive.length);
            var layout = {
                title: 'Amount of Explicit Margin Actually ',
                xaxis: {tickfont: {
                    size: 14,
                    color: 'rgb(107, 107, 107)'
                    }},
                yaxis: {
                    title: 'Amount of Explicit Margin Used (min)',
                    titlefont: {
                    size: 16,
                    color: 'rgb(107, 107, 107)'
                    },
                    tickfont: {
                    size: 14,
                    color: 'rgb(107, 107, 107)'
                    }
                },
                legend: {
                    x: 0,
                    y: 1.0,
                    bgcolor: 'rgba(255, 255, 255, 0)',
                    bordercolor: 'rgba(255, 255, 255, 0)'
                },
                barmode: 'group',
                bargap: 0.15,
                bargroupgap: 0.1
            };
            Plotly.newPlot('myDiv', data, layout);
//====================SECOND GRAPH===========================================
            var trace1 = {
                   
                y: all,
                name: "All",
                type: 'scatter'
            };
            var trace2 = {
                
                y: sb,
                type: 'scatter',
                name: "SB"
            };
            var trace3 = {
                
                y: arm,
                type: 'scatter',
                name: "arm"

            };
            var trace4 = {
                
                y: drive,
                type: 'scatter',
                name: "drive"
            };
            var layout = {
                title: "Reversed Axis with Min/Max", 
                xaxis: {
                    range: [100, 0]
                }
            };
            var data = [trace1, trace2, trace3, trace4];
            Plotly.newPlot('secondgraph', data, layout);


        }
        
//==============================THIRD GRAPH (TIME SERIES)===========================================
        
        var data = [{
        x: [0, 20, 40, 60, 80, 100],
        y: [20, 14, 23],
        type: 'bar'
        }
        ];
       
    </script>
  </body>
</html>